<!DOCTYPE html>
<html lang="en">
  <!-- Mirrored from coderthemes.com/yum/admin-order-list.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 01 Mar 2024 13:21:49 GMT -->
  <head>
    <meta charset="utf-8" />
    <title>Yum - Multipurpose Food Tailwind CSS Template</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta content="" name="description" />
    <meta content="coderthemes" name="author" />

    <!-- Theme favicon -->
    <link rel="shortcut icon" href="assets/img/favicon.ico" />

    <!--  Head js -->
    <script
      type="module"
      crossorigin
      src="assets/js/admin-order-list-7159724c.js"
    ></script>
    <link rel="modulepreload" crossorigin href="assets/js/theme-b118ffc1.js" />
    <link rel="modulepreload" crossorigin href="assets/js/index-a4e39586.js" />
    <link rel="stylesheet" href="assets/css/theme-c9540983.css" />
    <link rel="stylesheet" href="assets/css/custom.css" />
  </head>

  <body>
    <!-- Preloader -->
    <div
      id="preloader"
      class="fixed inset-0 z-70 bg-default-50 transition-all visible opacity-100 h-screen w-screen flex items-center justify-center"
    >
      <div
        class="animate-spin inline-block w-10 h-10 border-4 border-t-transparent border-primary rounded-full"
        role="status"
        aria-label="loading"
      >
        <span class="sr-only">Loading...</span>
      </div>
    </div>

    <!-- End Header -->
    <header
      id="navbar"
      class="sticky top-0 z-20 border-b border-default-200 bg-transparent transition-all"
    >
      <div class="lg:h-20 h-14 flex items-center">
        <div class="container">
          <div class="grid lg:grid-cols-3 grid-cols-2 items-center gap-4">
            <div class="flex">
              <!-- Mobile Menu Toggle Button -->
              <button
                style="display: none"
                class="lg:hidden block"
                data-hs-overlay="#mobile-menu"
              >
                <i
                  data-lucide="menu"
                  class="w-7 h-7 text-default-600 me-4 hover:text-primary"
                ></i>
              </button>

              <!-- Navbar Brand Logo -->
              <a href="home.html">
                <img
                  src="assets/img/Logo_popolare_2024x500_trasparente.png"
                  alt="logo"
                  class="h-18 mh-12 flex dark:hidden"
                />
                <img
                  src="assets/img/Logo_popolare_2024x500_trasparente.png"
                  alt="logo"
                  class="h-18 mh-12 hidden dark:flex"
                />
              </a>
            </div>
          </div>
        </div>
      </div>
    </header>
    <!-- End Header -->
    <!-- Start Sidebar -->
    <!-- End Sidebar -->
    <!-- Start Content -->
    <div class="w-full container">
      <div class="p-6 page-content">
        <div class="grid gap-6">
          <div class="xl:col-span-9">
            <div class="space-y-6">
              <div class="grid lg:grid-cols-4 sm:grid-cols-2 gap-6">
                <div
                  class="border rounded-lg p-6 overflow-hidden border-default-200"
                >
                  <div class="flex items-center gap-4">
                    <div
                      class="inline-flex items-center justify-center rounded-full bg-primary/20 text-primary h-16 w-16"
                    >
                      <i data-lucide="banknote" class="h-8 w-8"></i>
                    </div>
                    <div>
                      <p class="text-base text-default-500 font-medium mb-1">
                        Ordini Totali
                      </p>
                      <h4
                        id="ordini_totali"
                        class="text-2xl text-default-950 font-semibold mb-2"
                      ></h4>
                    </div>
                  </div>
                </div>
                <!-- end grid-cols -->
                <div
                  class="border rounded-lg p-6 overflow-hidden border-default-200"
                >
                  <div class="flex items-center gap-4">
                    <div
                      class="inline-flex items-center justify-center rounded-full bg-yellow-500/20 text-yellow-500 h-16 w-16"
                    >
                      <i data-lucide="wallet" class="h-8 w-8"></i>
                    </div>
                    <div>
                      <p class="text-base text-default-500 font-medium mb-1">
                        Bilancio Totale
                      </p>
                      <h4
                        id="bilancio_totale"
                        class="text-2xl text-default-950 font-semibold mb-2"
                      ></h4>
                    </div>
                  </div>
                </div>
                <!-- end grid-cols -->
                <div
                  class="border rounded-lg p-6 overflow-hidden border-default-200"
                >
                  <div class="flex items-center gap-4">
                    <div
                      class="inline-flex items-center justify-center rounded-full bg-green-500/20 text-green-500 h-16 w-16"
                    >
                      <i data-lucide="star" class="h-8 w-8 fill-green-500"></i>
                    </div>
                    <div class="">
                      <p class="text-base text-default-500 font-medium mb-1">
                        Bilancio Clienti
                      </p>
                      <h4
                        id="bilancio_clienti"
                        class="text-2xl text-default-950 font-semibold mb-2"
                      ></h4>
                    </div>
                  </div>
                </div>
                <!-- end grid-cols -->
                <div
                  class="border rounded-lg p-6 overflow-hidden border-default-200"
                >
                  <div class="flex items-center gap-4">
                    <div
                      class="inline-flex items-center justify-center rounded-full bg-green-500/20 text-green-500 h-16 w-16"
                    >
                      <i data-lucide="star" class="h-8 w-8 fill-green-500"></i>
                    </div>
                    <div class="">
                      <p class="text-base text-default-500 font-medium mb-1">
                        Bilancio Volontari
                      </p>
                      <h4
                        id="bilancio_volontari"
                        class="text-2xl text-default-950 font-semibold mb-2"
                      ></h4>
                    </div>
                  </div>
                </div>
                <!-- end grid-cols -->
              </div>
              <!-- end grid -->

              <div class="grid grid-cols-1">
                <div class="border rounded-lg border-default-200">
                  <div class="p-6 overflow-hidden">
                    <div
                      class="flex flex-wrap md:flex-nowrap items-center justify-between gap-4"
                    >
                      <h2 class="text-xl text-default-800 font-semibold">
                        Lista Ordini
                      </h2>

                      <div class="flex items-center">
                        <span class="text-base text-default-950 me-3"
                          >Sort By :</span
                        >
                        <div
                          class="hs-dropdown relative inline-flex [--placement:bottom-right]"
                        >
                          <button
                            type="button"
                            class="hs-dropdown-toggle flex items-center gap-2 font-medium text-default-950 text-sm py-2.5 px-4 xl:px-5 rounded-full border border-default-200 transition-all"
                          >
                            All
                            <i
                              data-lucide="chevron-down"
                              class="h-4 w-4"
                            ></i></button
                          ><!-- end dropdown button -->

                          <div
                            class="hs-dropdown-menu hs-dropdown-open:opacity-100 min-w-[200px] transition-[opacity,margin] mt-4 opacity-0 hidden z-20 bg-white dark:bg-default-50 shadow-[rgba(17,_17,_26,_0.1)_0px_0px_16px] rounded-lg border border-default-100 p-1.5"
                          >
                            <ul class="flex flex-col gap-1">
                              <li>
                                <a
                                  class="flex items-center gap-3 font-normal py-2 px-3 transition-all text-default-700 bg-default-400/20 rounded"
                                  href="javascript:void(0)"
                                  >All</a
                                >
                              </li>
                              <li>
                                <a
                                  class="flex items-center gap-3 font-normal text-default-600 py-2 px-3 transition-all hover:text-default-700 hover:bg-default-400/20 rounded"
                                  href="javascript:void(0)"
                                  >Refund</a
                                >
                              </li>
                              <li>
                                <a
                                  class="flex items-center gap-3 font-normal text-default-600 py-2 px-3 transition-all hover:text-default-700 hover:bg-default-400/20 rounded"
                                  href="javascript:void(0)"
                                  >Paid</a
                                >
                              </li>
                              <li>
                                <a
                                  class="flex items-center gap-3 font-normal text-default-600 py-2 px-3 transition-all hover:text-default-700 hover:bg-default-400/20 rounded"
                                  href="javascript:void(0)"
                                  >Cancel</a
                                >
                              </li>
                            </ul>
                            <!-- end dropdown items -->
                          </div>
                          <!-- end dropdown menu -->
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="relative overflow-x-auto">
                    <div class="min-w-full inline-block align-middle">
                      <div class="overflow-hidden">
                        <table class="min-w-full divide-y divide-default-200">
                          <thead class="bg-default-100">
                            <tr class="text-start">
                              <th
                                class="px-6 py-3 text-start text-sm whitespace-nowrap font-medium text-default-800"
                              >
                                Data
                              </th>
                              <th
                                class="px-6 py-3 text-start text-sm whitespace-nowrap font-medium text-default-800"
                              >
                                Order ID
                              </th>
                              <th
                                class="px-6 py-3 text-start text-sm whitespace-nowrap font-medium text-default-800 min-w"
                              >
                                Ordine N.
                              </th>
                              <th
                                class="px-6 py-3 text-start text-sm whitespace-nowrap font-medium text-default-800"
                              >
                                Cliente
                              </th>
                              <th
                                class="px-6 py-3 text-start text-sm whitespace-nowrap font-medium text-default-800 min-w-[10rem]"
                              >
                                Totale
                              </th>
                            </tr>
                            <!-- end table-head-row -->
                          </thead>
                          <!-- end t-head -->
                          <tbody
                            id="orders-table-body"
                            class="divide-y divide-default-200"
                          >
                            <!-- Elenco ordini -->
                            <!-- end table-row -->
                          </tbody>
                          <!-- end t-body -->
                        </table>
                        <!-- end table -->
                      </div>
                      <!-- end overflo-hidden -->
                    </div>
                    <!-- end table-responsive -->
                  </div>
                </div>
              </div>
              <!-- end grid -->
            </div>
          </div>
          <!-- end grid-cols -->

          <!-- end grid-cols -->
        </div>
        <!-- end grid -->
      </div>
    </div>
    <!-- End Content -->
    <script>
      // Dichiarazione delle variabili globali
      let OrderItemList = [];
      let OrderTotalSum = 0;
      let numeroOrdineIncrementale = 0;
      let OrderdTotalClient = 0;
      let OrderdTotalGuest = 0;
      let orderData = [];
      let loadedOrderIds = [];

      // Funzione per caricare i dati dal localStorage
      function loadFromLocalStorage() {
        // Carica l'array
        OrderItemList = JSON.parse(localStorage.getItem("OrderItemList")) || [];

        // Carica la somma totale con decimali
        OrderTotalSum = parseFloat(localStorage.getItem("OrderTotalSum")) || 0;

        // Carica ordini totali
        numeroOrdineIncrementale =
          parseInt(localStorage.getItem("TotalOrder"), 10) || 0;

        // Carica OrderdTotalClient con decimali
        OrderdTotalClient =
          parseFloat(localStorage.getItem("OrderdTotalClient")) || 0;

        // Carica OrderdTotalGuest con decimali
        OrderdTotalGuest =
          parseFloat(localStorage.getItem("OrderdTotalGuest")) || 0;
      }

      // Assicurati che questo script venga eseguito dopo il caricamento completo dell'HTML
      document.addEventListener("DOMContentLoaded", function () {
        // Chiamata alla funzione per caricare i dati dal localStorage all'inizializzazione
        loadFromLocalStorage();
        updatePage(); // Chiamata iniziale per visualizzare i valori all'avvio
        // Chiamata iniziale per caricare i dati dal server
        fetchAndDisplayOrders();

        // Aggiorna i valori ogni 1 secondi
        setInterval(updatePage, 5000);

        // Aggiorna i valori e la tabella ogni 5 secondi
        setInterval(fetchAndDisplayOrders, 5000);

        // setInterval(function () {
        //   // Assicurati di avere i dati necessari per la funzione displayOrdersTable
        //   if (orderData) {
        //     displayOrdersTable(orderData);
        //   }
        // }, 5000);
      });

      function updatePage() {
        // Esegui l'aggiornamento dei valori qui
        loadFromLocalStorage();
        // Aggiorna il contenuto dell'elemento con l'ID "ordini_totali"
        const elementoOrdiniTotali = document.getElementById("ordini_totali");
        elementoOrdiniTotali.innerText = numeroOrdineIncrementale;

        // Aggiorna il contenuto dell'elemento con l'ID "bilancio_totale"
        const elementoSommaTotali = document.getElementById("bilancio_totale");
        elementoSommaTotali.innerText = formatCurrency(OrderTotalSum);

        // Aggiorna il contenuto dell'elemento con l'ID "bilancio_clienti"
        const elementoTotaleCliente =
          document.getElementById("bilancio_clienti");
        elementoTotaleCliente.innerText = formatCurrency(OrderdTotalClient);

        // Aggiorna il contenuto dell'elemento con l'ID "bilancio_volontari"
        const elementoTotaleVolontari =
          document.getElementById("bilancio_volontari");
        elementoTotaleVolontari.innerText = formatCurrency(OrderdTotalGuest);
      }

      // Formatta il valore come valuta (ad esempio, aggiungi il simbolo €)
      function formatCurrency(value) {
        return new Intl.NumberFormat("it-IT", {
          style: "currency",
          currency: "EUR",
        }).format(value);
      }

      // Funzione per caricare i dati dal server e aggiornare la tabella
      async function fetchAndDisplayOrders() {
        try {
          const response = await fetch("http://localhost:3000/api/orders");
          const newOrderData = await response.json();

          // Filtra solo i nuovi ordini non ancora caricati
          const newOrders = newOrderData.filter(
            (order) => !loadedOrderIds.includes(order.id)
          );

          // Aggiorna gli ID degli ordini già caricati
          loadedOrderIds = [
            ...loadedOrderIds,
            ...newOrders.map((order) => order.id),
          ];

          // Aggiungi solo i nuovi ordini alla tabella
          displayOrdersTable(newOrders);

          // Aggiungi l'intervallo per aggiornare la tabella ogni 5 secondi
          setInterval(function () {
            // Assicurati di avere i dati necessari per la funzione displayOrdersTable
            if (orderData) {
              displayOrdersTable(orderData);
              console.log("Nuovi ordini:", orderData);
            }
          }, 50000);
        } catch (error) {
          console.error("Errore nella richiesta API:", error);
        }
      }

      // Funzione per visualizzare gli ordini nella tabella
      function displayOrdersTable(newOrders) {
        // Ordina gli ordini in base alla data e all'ora (dalla più recente alla più vecchia)
        newOrders.sort((a, b) => new Date(b.date) - new Date(a.date));

        const tableBody = document.getElementById("orders-table-body");

        newOrders.forEach((order) => {
          // Verifica se l'ordine è già presente nella tabella
          const existingRow = document.getElementById(`order-row-${order.id}`);

          if (!existingRow) {
            // Formattare la data e l'ora dell'ordine
            const formattedDate = order.date.substring(0, 10); // Ottieni i primi 10 caratteri come data (YYYY-MM-DD)
            const formattedTime = order.date.substring(11, 19); // Ottieni i successivi 8 caratteri come ora (HH:mm:ss)

            // Creare la riga della tabella
            const row = document.createElement("tr");
            row.id = `order-row-${order.id}`;
            row.innerHTML = `
        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-default-500">${formattedDate} ${formattedTime}</td>
        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-default-500">#${order.id}</td>
        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-default-500">${order.order}</td>
        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-default-500">${order.guest}</td>
        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-default-500">${order.total} €</td>
      `;

            // Aggiungere la riga alla tabella
            tableBody.appendChild(row);
          }
        });
      }

      // function generateStarIcons(rating) {
      //   const stars = Array.from(
      //     { length: rating },
      //     (_, index) => `
      //                     <button><i data-lucide="star" class="h-5 w-5 text-yellow-400 fill-yellow-400"></i></button>
      //                   `
      //   ).join("");

      //   return stars;
      // }
    </script>
    <!-- Back to Top & Light/Dark Toggle -->
    <div
      class="fixed lg:bottom-5 end-5 bottom-18 flex flex-col items-center bg-primary/25 rounded-full z-10"
    >
      <button
        class="h-0 w-8 opacity-0 flex justify-center items-center transition-all duration-500 translate-y-5 z-10"
        data-toggle="back-to-top"
      >
        <i class="h-5 w-5 text-primary-500 mt-1" data-lucide="chevron-up"></i>
      </button>
      <button
        class="rounded-full h-10 w-10 bg-primary text-white flex justify-center items-center z-20"
      >
        <i class="h-5 w-5" data-lucide="sun" id="light-theme"></i>
        <i class="h-5 w-5" data-lucide="moon" id="dark-theme"></i>
      </button>
    </div>
  </body>

  <!-- Mirrored from coderthemes.com/yum/admin-order-list.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 01 Mar 2024 13:21:50 GMT -->
</html>
